<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Details - InvestSherpa.in</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .btn-primary { background-color: #1e3a8a; color: white; transition: background-color 0.3s ease; }
        .btn-primary:hover { background-color: #1c347d; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-2">
                <div class="p-2 bg-blue-900 rounded-lg"><i class="fas fa-shield-alt text-white text-xl"></i></div>
                <span class="text-2xl font-bold text-blue-900">InvestSherpa.in</span>
            </a>
             <nav class="hidden md:flex items-center space-x-8">
                <a href="index.html" class="text-gray-600 hover:text-blue-900 font-medium">Home</a>
                <a href="browselisting.html" class="text-gray-600 hover:text-blue-900 font-medium">Browse</a>
            </nav>
            <div class="hidden md:flex items-center space-x-4">
                <a href="login.html" class="text-blue-900 font-semibold hover:underline">Login</a>
                <a href="addlisting.html" class="btn-secondary font-semibold py-2 px-4 rounded-lg shadow-md">List Your Business</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <div id="loading-state" class="text-center"><p>Loading profile...</p></div>
        <div id="profile-content" class="grid grid-cols-1 lg:grid-cols-3 gap-12 hidden">
            
            <div class="lg:col-span-2">
                <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center">
                        <img id="profile-logo" src="" alt="Business Logo" class="w-24 h-24 rounded-full mr-6 mb-4 sm:mb-0 border-4 border-blue-100">
                        <div>
                            <h1 id="business-name" class="text-4xl font-bold text-blue-900"></h1>
                            <p id="tagline" class="text-gray-600 text-lg mt-1"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                    <h2 class="text-2xl font-bold text-blue-900 mb-4 border-b pb-2">About Us</h2>
                    <p id="about-us" class="text-gray-700 leading-relaxed"></p>
                </div>

                <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                    <h2 class="text-2xl font-bold text-blue-900 mb-6 border-b pb-2">Products & Services</h2>
                    <div id="services-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        </div>
                </div>
                
                <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                    <h2 class="text-2xl font-bold text-blue-900 mb-6 border-b pb-2">Client Testimonials</h2>
                    <div id="testimonials-container" class="space-y-6">
                        </div>
                </div>
            </div>

            <div class="lg:col-span-1 space-y-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">Contact & Location</h3>
                    <div class="space-y-4 text-gray-700">
                        <p><i class="fas fa-phone-alt w-6 text-blue-800"></i> <span id="contact-phone"></span></p>
                        <p><i class="fas fa-envelope w-6 text-blue-800"></i> <span id="contact-email"></span></p>
                        <p><i class="fas fa-globe w-6 text-blue-800"></i> <a id="contact-website" href="#" class="hover:underline"></a></p>
                        <p><i class="fas fa-map-marker-alt w-6 text-blue-800"></i> <span id="contact-address"></span></p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">Quick Info</h3>
                    <div class="space-y-3 text-gray-700">
                        <p><i class="fas fa-certificate w-6 text-green-700"></i> <strong>License:</strong> <span id="quick-license"></span></p>
                        <p><i class="fas fa-globe-asia w-6 text-green-700"></i> <strong>Service Area:</strong> <span id="quick-area"></span></p>
                        <p><i class="fas fa-users w-6 text-green-700"></i> <strong>Client Focus:</strong> <span id="quick-focus"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
        const SUPABASE_URL = 'https://fjqvfzlfhhkfohprlqhm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqcXZmemxmaGhrZm9ocHJscWhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0ODYyNzAsImV4cCI6MjA3MjA2MjI3MH0.QB_QA-aKeoaxswUpnjBXxerzc-z0tSxerQCQ-hHyLXQ';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const loadingEl = document.getElementById('loading-state');
        const contentEl = document.getElementById('profile-content');

        // --- GET PROFILE ID FROM URL ---
        const urlParams = new URLSearchParams(window.location.search);
        const profileId = urlParams.get('id');

        // --- FETCH AND DISPLAY FULL PROFILE ---
        async function loadProfile() {
            if (!profileId) {
                loadingEl.innerHTML = '<p class="text-red-500">No profile ID provided.</p>';
                return;
            }

            // --- 1. Fetch main profile details ---
            const { data: profile, error: profileError } = await supabase
                .from('professional_profiles')
                .select(`
                    *,
                    professional_categories(categories(*)),
                    reviews(rating, comment, user_profiles(full_name))
                `)
                .eq('id', profileId)
                .single();

            if (profileError || !profile) {
                console.error('Error fetching profile:', profileError);
                loadingEl.innerHTML = '<p class="text-red-500">Could not load this profile.</p>';
                return;
            }
            
            // --- 2. Populate the page with data ---
            document.title = `${profile.business_name} - Details`;
            document.getElementById('profile-logo').src = profile.logo_url || 'https://placehold.co/100x100/1e3a8a/ffffff?text=??';
            document.getElementById('business-name').textContent = profile.business_name;
            document.getElementById('tagline').textContent = profile.tagline;
            document.getElementById('about-us').textContent = profile.about;
            document.getElementById('contact-phone').textContent = profile.phone;
            document.getElementById('contact-email').textContent = profile.email;
            document.getElementById('contact-website').href = profile.website_url;
            document.getElementById('contact-website').textContent = profile.website_url;
            document.getElementById('contact-address').textContent = `${profile.address}, ${profile.city}, ${profile.state} ${profile.pincode}`;
            document.getElementById('quick-license').textContent = profile.license_info || 'N/A';
            document.getElementById('quick-area').textContent = profile.service_area || 'N/A';
            document.getElementById('quick-focus').textContent = profile.client_focus || 'N/A';

            // --- 3. Populate Services ---
            const servicesGrid = document.getElementById('services-grid');
            servicesGrid.innerHTML = '';
            profile.professional_categories.forEach(pc => {
                const category = pc.categories;
                const service = `
                    <div class="flex items-start space-x-4">
                        <i class="${category.icon_class} text-3xl text-blue-900 mt-1"></i>
                        <div><h3 class="font-semibold text-lg">${category.name}</h3></div>
                    </div>`;
                servicesGrid.innerHTML += service;
            });
            
            // --- 4. Populate Testimonials ---
            const testimonialsContainer = document.getElementById('testimonials-container');
            testimonialsContainer.innerHTML = '';
            if (profile.reviews.length > 0) {
                profile.reviews.forEach(review => {
                    const stars = '‚≠ê'.repeat(review.rating);
                    const testimonial = `
                        <div class="border-l-4 border-blue-800 pl-4">
                            <div class="flex items-center text-yellow-500 mb-1">${stars}</div>
                            <p class="text-gray-700 italic">"${review.comment}"</p>
                            <p class="font-semibold text-gray-800 mt-2">- ${review.user_profiles.full_name}</p>
                        </div>`;
                    testimonialsContainer.innerHTML += testimonial;
                });
            } else {
                testimonialsContainer.innerHTML = '<p>No reviews yet for this professional.</p>';
            }

            // --- 5. Show the content ---
            loadingEl.classList.add('hidden');
            contentEl.classList.remove('hidden');
        }

        document.addEventListener('DOMContentLoaded', loadProfile);
    </script>
</body>
</html>