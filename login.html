<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Your Business - InvestSherpa.in</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .btn-primary { background-color: #1e3a8a; color: white; transition: background-color 0.3s ease; }
        .btn-primary:hover { background-color: #1c347d; }
        .btn-primary:disabled { background-color: #6b7280; cursor: not-allowed; }
        .btn-secondary { background-color: #f59e0b; color: white; transition: background-color 0.3s ease; }
        .btn-secondary:hover { background-color: #e4900a; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="flex items-center space-x-2">
                <div class="p-2 bg-blue-900 rounded-lg"><i class="fas fa-shield-alt text-white text-xl"></i></div>
                <span class="text-2xl font-bold text-blue-900">InvestSherpa.in</span>
            </a>
            <div class="hidden md:flex items-center space-x-4">
                <a href="#" class="text-blue-900 font-semibold hover:underline">Login</a>
                <a href="#" class="btn-secondary font-semibold py-2 px-4 rounded-lg shadow-md">List Your Business</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <section id="submission-form" class="py-16">
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-xl">
                <h2 class="text-3xl font-bold text-blue-900 mb-2">Create Your Professional Profile</h2>
                <p class="text-gray-600 mb-8">This form is for registered users. Please log in before submitting. Fill out the details below to be listed in our directory.</p>
                
                <form class="space-y-8" id="professional-form">
                    <fieldset class="border-t-2 border-blue-200 pt-6">
                        <legend class="text-xl font-bold text-blue-900 px-4">Business Information</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            <div>
                                <label for="company_name" class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                                <input type="text" id="company_name" name="company_name" placeholder="e.g., Aditya Financial Services" class="w-full p-3 border border-gray-300 rounded-lg" required>
                            </div>
                             <div>
                                <label for="website_url" class="block text-sm font-medium text-gray-700 mb-1">Website URL</label>
                                <input type="url" id="website_url" name="website_url" placeholder="https://example.com" class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="border-t-2 border-blue-200 pt-6">
                        <legend class="text-xl font-bold text-blue-900 px-4">Professional Details</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                             <div>
                                <label for="professional_type" class="block text-sm font-medium text-gray-700 mb-1">Type of Professional</label>
                                <select id="professional_type" name="professional_type" class="w-full p-3 border border-gray-300 rounded-lg" required>
                                    <option value="" disabled selected>Select a type</option>
                                    <option value="financial_advisor">Financial Advisor</option>
                                    <option value="insurance_agent">Insurance Agent</option>
                                    <option value="wealth_manager">Wealth Manager</option>
                                </select>
                            </div>
                            <div>
                                <label for="license_number" class="block text-sm font-medium text-gray-700 mb-1">License Number (SEBI, IRDAI, etc.)</label>
                                <input type="text" id="license_number" name="license_number" class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                            <div class="md:col-span-2">
                                <label for="specializations" class="block text-sm font-medium text-gray-700 mb-1">Specializations (comma-separated)</label>
                                <input type="text" id="specializations" name="specializations" placeholder="e.g., Mutual Funds, Term Insurance, Retirement Planning" class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                             <div class="md:col-span-2">
                                <label for="bio" class="block text-sm font-medium text-gray-700 mb-1">About / Bio</label>
                                <textarea id="bio" name="bio" rows="5" placeholder="Describe your experience, mission, and what makes you unique." class="w-full p-3 border border-gray-300 rounded-lg" required></textarea>
                            </div>
                        </div>
                    </fieldset>

                    <div class="border-t-2 border-blue-200 pt-6 text-center">
                         <label class="flex items-center justify-center space-x-2 mb-6">
                            <input type="checkbox" required class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                            <span class="text-gray-700">I confirm that the information provided is accurate.</span>
                         </label>
                        <button type="submit" id="submit-button" class="btn-primary font-bold py-3 px-10 rounded-lg shadow-md">
                            Submit for Approval
                        </button>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <footer class="bg-blue-900 text-white mt-16">
        <div class="container mx-auto px-6 py-12 text-center">
            <p>Â© 2024 InvestSherpa.in. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // 1. Initialize the Supabase Client with your project details
        const supabaseUrl = 'https://tapnnlkokcbzckbbdxez.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhcG5ubGtva2NiemNrYmJkeGV6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1Mzc4NDEsImV4cCI6MjA2OTExMzg0MX0.ks3HUfeA-KNJmsgKNhb5xYlv-VXkZkRJC-3EG6D6R-w';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // 2. Select the form and the submit button from the HTML
        const professionalForm = document.getElementById('professional-form');
        const submitButton = document.getElementById('submit-button');

        // 3. Add an event listener for the form's 'submit' event
        professionalForm.addEventListener('submit', async (event) => {
            // Prevent the form from reloading the page
            event.preventDefault();

            // Disable the button to prevent multiple submissions
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';

            try {
                // 4. Get the currently logged-in user
                const { data: { user }, error: authError } = await supabase.auth.getUser();

                // If no user is logged in, show an error and stop.
                if (authError || !user) {
                    throw new Error('You must be logged in to create a profile.');
                }

                // 5. Collect form data using the 'name' attributes of the inputs
                const formData = new FormData(professionalForm);
                
                // Convert comma-separated specializations into a text array for Supabase
                const specializationsArray = formData.get('specializations').split(',').map(s => s.trim()).filter(s => s);

                // 6. Structure the data to match your 'professional_profiles' table columns
                const profileData = {
                    user_id: user.id, // Link to the logged-in user
                    company_name: formData.get('company_name'),
                    professional_type: formData.get('professional_type'),
                    license_number: formData.get('license_number'),
                    specializations: specializationsArray, // This is now an array
                    bio: formData.get('bio'),
                    website_url: formData.get('website_url'),
                    status: 'pending' // Default status as per your schema
                };

                // 7. Insert the data into the 'professional_profiles' table
                const { error } = await supabase
                    .from('professional_profiles')
                    .insert([profileData]);

                if (error) {
                    // If Supabase returns an error, throw it to be caught by the catch block
                    throw error;
                }

                // 8. Provide success feedback to the user
                alert('Success! Your professional profile has been submitted for review.');
                professionalForm.reset(); // Clear the form fields

            } catch (error) {
                // 9. Provide error feedback if anything fails
                console.error('Error submitting profile:', error.message);
                alert(`Submission failed: ${error.message}`);
            } finally {
                // 10. Re-enable the button, whether submission succeeded or failed
                submitButton.disabled = false;
                submitButton.textContent = 'Submit for Approval';
            }
        });
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
</body>
</html>